# GitHub Actions 工作流程名稱
name: Deploy Trading Workbench to GitHub Pages

# 觸發條件：當推送到 main 分支時執行
on:
  push:
    branches:
      - main # 您的主要分支名稱

# ❗❗❗ **關鍵修正：新增部署所需的權限** ❗❗❗
permissions:
  contents: read
  pages: write
  id-token: write

# 工作流程執行的步驟
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # 步驟 1: 簽出您的儲存庫程式碼
      - name: Checkout
        uses: actions/checkout@v4

      # 步驟 2: 安全地替換 Firebase 設定
      - name: Replace Firebase Config
        run: |
          # 從 GitHub Secrets 讀取經過 Base64 編碼的設定
          # 並將其解碼後，安全地寫入 HTML 檔案中
          echo "${{ secrets.FIREBASE_CONFIG }}" | base64 --decode > firebase_config.json
          sed -i "s|atob('__FIREBASE_CONFIG_B64__')|'$(cat firebase_config.json)'|" trading_workbench_github.html

      # 步驟 3: 設定 GitHub Pages
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # 步驟 4: 上傳部署成果
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.' # 上傳整個根目錄的檔案

      # 步驟 5: 部署到 GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
